
{
  "entities": {
    "Library": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Library",
      "type": "object",
      "description": "Represents a library in the CampusHub system. This is the root level entity for multi-tenancy.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Library entity."
        },
        "name": {
          "type": "string",
          "description": "Name of the library."
        },
        "address": {
            "type": "string",
            "description": "Physical address of the library."
        },
        "ownerId": {
            "type": "string",
            "description": "The UID of the user who owns/created the library."
        },
        "contactEmail": { "type": "string", "format": "email" },
        "contactPhone": { "type": "string" },
        "timezone": { "type": "string" },
        "billingCycle": { "type": "string", "enum": ["monthly", "yearly"] },
        "createdAt": {
          "type": "string",
          "description": "Timestamp indicating when the library was created.",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "description": "Timestamp indicating when the library was last updated.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "name",
        "address",
        "ownerId",
        "createdAt",
        "updatedAt"
      ]
    },
    "Invite": {
      "title": "Invite",
      "type": "object",
      "description": "Represents an invite code for users to join a library.",
      "properties": {
        "id": { "type": "string" },
        "libraryId": { "type": "string" },
        "role": { "type": "string", "enum": ["student", "libraryStaff"] },
        "email": { "type": "string", "format": "email", "description": "If set, only this email can use the invite." },
        "inviteCode": { "type": "string", "description": "Unique, short, human-readable code." },
        "expiresAt": { "type": "string", "format": "date-time" },
        "used": { "type": "boolean" },
        "usedBy": { "type": "string", "description": "UID of the user who used the invite."},
        "createdBy": { "type": "string", "description": "UID of the admin who created it." },
        "createdAt": { "type": "string", "format": "date-time" }
      },
      "required": ["id", "libraryId", "role", "inviteCode", "expiresAt", "used", "createdBy", "createdAt"]
    },
    "UserToLibraryMapping": {
        "title": "User To Library Mapping",
        "type": "object",
        "description": "Stores the libraryId and role for a given user UID for quick tenant resolution.",
        "properties": {
          "libraryId": {
            "type": "string",
            "description": "The ID of the library the user belongs to. Null for system admins."
          },
          "role": {
            "type": "string",
            "enum": ["admin", "libraryOwner", "libraryStaff", "student"]
          }
        },
        "required": ["role"]
    },
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user in the CampusHub system.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the User entity (matches Firebase Auth UID)."
        },
        "libraryId": {
          "type": "string",
          "description": "Reference to Library. Optional for system admins."
        },
        "name": {
          "type": "string",
          "description": "The user's display name."
        },
        "email": {
          "type": "string",
          "description": "Email address of the user.",
          "format": "email"
        },
        "role": {
          "type": "string",
          "description": "Role of the user, used for authorization.",
          "enum": [
            "admin",
            "libraryOwner",
            "libraryStaff",
            "student"
          ]
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp indicating when the user was created.",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "description": "Timestamp indicating when the user was last updated.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "name",
        "email",
        "role",
        "createdAt",
        "updatedAt"
      ]
    },
    "Student": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Student",
      "type": "object",
      "description": "Represents a student in the CampusHub system.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Custom unique identifier for the Student entity."
        },
        "libraryId": {
          "type": "string",
          "description": "Reference to Library."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User."
        },
        "name": {
          "type": "string",
          "description": "Name of the student."
        },
        "email": {
          "type": "string",
          "description": "Contact email of the student.",
          "format": "email"
        },
        "status": {
          "type": "string",
          "description": "The lifecycle status of the student.",
          "enum": [
            "active",
            "at-risk",
            "inactive"
          ]
        },
        "fibonacciStreak": {
          "type": "number"
        },
        "lastInteractionAt": {
          "type": "string",
          "format": "date-time"
        },
        "createdAt": {
          "type": "string",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "libraryId",
        "name",
        "email",
        "status",
        "createdAt",
        "updatedAt"
      ]
    },
    "Bill": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Bill",
      "type": "object",
      "properties": {
        "id": { "type": "string" },
        "libraryId": { "type": "string" },
        "studentId": { "type": "string" },
        "studentName": { "type": "string" },
        "totalAmount": { "type": "number" },
        "status": { "type": "string", "enum": ["Due", "Paid", "Overdue", "Cancelled"] },
        "issuedAt": { "type": "string", "format": "date-time" },
        "dueDate": { "type": "string", "format": "date-time" }
      },
      "required": ["id", "libraryId", "studentId", "studentName", "totalAmount", "status", "issuedAt", "dueDate"]
    },
    "ActivityLog": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ActivityLog",
      "type": "object",
      "properties": {
        "id": { "type": "string" },
        "libraryId": { "type": "string" },
        "user": {
          "type": "object",
          "properties": {
            "id": { "type": "string" },
            "name": { "type": "string" }
          }
        },
        "activityType": { "type": "string" },
        "timestamp": { "type": "string", "format": "date-time" }
      },
      "required": ["id", "libraryId", "user", "activityType", "timestamp"]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "users/{userId}",
        "definition": {
          "entityName": "UserToLibraryMapping",
          "schema": {
            "$ref": "#/backend/entities/UserToLibraryMapping"
          },
          "description": "Top-level mapping of a user UID to their libraryId and role."
        }
      },
      {
        "path": "libraries/{libraryId}",
        "definition": {
          "entityName": "Library",
          "schema": {
            "$ref": "#/backend/entities/Library"
          },
          "description": "Root collection for all library-specific data."
        }
      },
      {
        "path": "libraries/{libraryId}/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profiles within a library."
        }
      },
      {
        "path": "libraries/{libraryId}/students/{studentId}",
        "definition": {
          "entityName": "Student",
          "schema": {
            "$ref": "#/backend/entities/Student"
          },
          "description": "Stores student data."
        }
      }
    ]
  }
}
